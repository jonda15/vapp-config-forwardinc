{
  "apiVersion": "v1",
  "kind": "Template",
  "metadata": {
    "annotations": {
      "description": "CA Identity Governance 12.6.04.ga ForwardInc"
    },
    "creationTimestamp": null,
    "name": "ig-12-6-04-ga-forwardinc",
    "namespace": "ig-12-6-04-ga-forwardinc"
  },
  "objects": [
    {
      "apiVersion": "v1",
      "kind": "Namespace",
      "metadata": {
        "name": "${SOLUTION_NAMESPACE}"
      }
    },
    {
      "apiVersion": "v1",
      "kind": "ReplicationController",
      "metadata": {
        "name": "ig-server"
      },
      "spec": {
        "replicas": 1,
        "selector": {
          "ca.com/ig": "ig-server"
        },
        "template": {
          "metadata": {
            "labels": {
              "ca.com/ig": "ig-server"
            },
            "name": "ig-server"
          },
          "spec": {
            "containers": [
              {
                "env": [
                  {
                    "name": "DESTINATION",
                    "value": "/solution"
                  },
                  {
                    "name": "GITHUB_TOKEN",
                    "value": "${OAUTH_TOKEN}"
                  },
                  {
                    "name": "SOURCE",
                    "value": "${SOLUTION_CONFIGURATION}"
                  }
                ],
                "image": "store.vapp-security.solutions/vapp/sidecar-configsvc:latest",
                "name": "configuration",
                "volumeMounts": [
                  {
                    "mountPath": "/solution",
                    "name": "configuration"
                  }
                ]
              },
              {
                "env": [
                  {
                    "name": "CONFIG",
                    "value": "forwardinc/igserver"
                  },
                  {
                    "name": "IG_DB_HOST",
                    "value": "${IG_DB_HOST}"
                  },
                  {
                    "name": "IG_DB_USER",
                    "value": "${IG_DB_USER}"
                  },
                  {
                    "name": "IG_DB_PASSWORD",
                    "value": "${IG_DB_PASSWORD}"
                  },
                  {
                    "name": "IG_DB_PORT",
                    "value": "${IG_DB_PORT}"
                  },
                  {
                    "name": "IG_DB_VENDOR",
                    "value": "${IG_DB_VENDOR}"
                  },
                  {
                    "name": "IG_DBS_PASSWORDS",
                    "value": "${IG_DBS_PASSWORDS}"
                  }
                ],
                "image": "store.vapp-security.solutions/imag/ig-server:12.6.04.ga",
                "name": "ig-server",
                "ports": [
                  {
                    "containerPort": 8080
                  },
                  {
                    "containerPort": 8443
                  }
                ],
                "readinessProbe": {
                  "httpGet": {
                    "path": "/eurekify/portal/login",
                    "port": 8080
                  },
                  "initialDelaySeconds": 120
                },
                "volumeMounts": [
                  {
                    "mountPath": "/solution",
                    "name": "configuration"
                  }
                ]
              }
            ],
            "dnsPolicy": "ClusterFirst",
            "restartPolicy": "Always",
            "volumes": [
              {
                "name": "configuration",
                "emptyDir": {}
              }
            ]
          }
        }
      }
    },
    {
      "apiVersion": "v1",
      "kind": "ReplicationController",
      "metadata": {
        "name": "connserver"
      },
      "spec": {
        "replicas": 1,
        "selector": {
          "ca.com/ig": "connserver"
        },
        "template": {
          "metadata": {
            "labels": {
              "ca.com/ig": "connserver"
            },
            "name": "connserver"
          },
          "spec": {
            "containers": [
              {
                "env": [
                  {
                    "name": "DESTINATION",
                    "value": "/solution"
                  },
                  {
                    "name": "GITHUB_TOKEN",
                    "value": "${OAUTH_TOKEN}"
                  },
                  {
                    "name": "SOURCE",
                    "value": "${SOLUTION_CONFIGURATION}"
                  }
                ],
                "image": "store.vapp-security.solutions/vapp/sidecar-configsvc:latest",
                "name": "configuration",
                "volumeMounts": [
                  {
                    "mountPath": "/solution",
                    "name": "configuration"
                  }
                ]
              },
              {
                "env": [
                  {
                    "name": "CONFIG",
                    "value": "forwardinc/jcs"
                  }
                ],
                "image": "store.vapp-security.solutions/imag/connector-server:latest",
                "name": "connserver",
                "ports": [
                  {
                    "containerPort": 20080
                  },
                  {
                    "containerPort": 20410
                  },
                  {
                    "containerPort": 20411
                  },
                  {
                    "containerPort": 20443
                  },
                  {
                    "containerPort": 22001
                  },
                  {
                    "containerPort": 22002
                  },
                  {
                    "containerPort": 22099
                  }
                ],
                "readinessProbe": {
                  "tcpSocket": {
                    "port": 20410
                  },
                  "initialDelaySeconds": 60
                },
                "volumeMounts": [
                  {
                    "mountPath": "/solution",
                    "name": "configuration"
                  }
                ]
              }
            ],
            "dnsPolicy": "ClusterFirst",
            "restartPolicy": "Always",
            "volumes": [
              {
                "name": "configuration",
                "emptyDir": {}
              }
            ]
          }
        }
      }
    },
    {
      "apiVersion": "v1",
      "kind": "Service",
      "metadata": {
        "name": "connserver"
      },
      "spec": {
        "ports": [
          {
            "name": "httpport",
            "port": 20080,
            "targetPort": 20080
          },
          {
            "name": "ldap",
            "port": 20410,
            "targetPort": 20410
          },
          {
            "name": "ldaps",
            "port": 20411,
            "targetPort": 20411
          },
          {
            "name": "httpsport",
            "port": 20443,
            "targetPort": 20443
          },
          {
            "name": "apache",
            "port": 22001,
            "targetPort": 22001
          },
          {
            "name": "apache2",
            "port": 22002,
            "targetPort": 22002
          },
          {
            "name": "rmiport",
            "port": 22099,
            "targetPort": 20099
          }
        ],
        "selector": {
          "ca.com/ig": "connserver"
        }
      }
    },
    {
      "apiVersion": "v1",
      "kind": "Service",
      "metadata": {
        "annotations": {
          "ca.com/cluster-public-hostname": "forwardinc-ig.ca.local",
          "ca.com/cluster-public-url": "/eurekify/portal/login",
          "ca.com/cluster-public-urlpath": "/eurekify",
          "ca.com/cluster-public-urlpath-backend": "/eurekify",
          "ca.com/cluster-public-urltext": "Identity Governance Environment"
        },
        "labels": {
          "ca.com/cluster-public-service": "http"
        },
        "name": "ig-ui"
      },
      "spec": {
        "ports": [
          {
            "port": 80,
            "targetPort": 8080
          }
        ],
        "selector": {
          "ca.com/ig": "ig-server"
        },
        "sessionAffinity": "ClientIP"
      }
    }
  ],
  "parameters": [
    {
      "description": "The Github OAuth token used to access your configuration.  Change this token if you use OAuth to access your custom configuration.",
      "name": "OAUTH_TOKEN",
      "value": ""
    },
    {
      "description": "The URL of your configuration.  Change this URL to use a custom configuration.",
      "name": "SOLUTION_CONFIGURATION",
      "value": "https://github.com/ca-imag/vapp-config-forwardinc/archive/IG-12.6.04.zip"
    },
    {
      "description": "Provide a Database Vendor name.  The Database Vendor should be sqlserver or oracle",
      "name": "IG_DB_VENDOR",
      "value": ""
    },
    {
      "description": "Provide a Database Host name which is used to store the data for Identity Governance",
      "name": "IG_DB_HOST",
      "value": ""
    },
    {
      "description": "Provide a Database Port number. If the value is not provided, the default port is 1433 for sqlserver and 1521 for oracle",
      "name": "IG_DB_PORT",
      "value": ""
    },
    {
      "description": "Provide a Database User name to connect to the Identity Governance Database Server",
      "name": "IG_DB_USER",
      "value": ""
    },
    {
      "description": "Provide a Database Password to connect to the Identity Governance Database Server",
      "name": "IG_DB_PASSWORD",
      "value": ""
    },
    {
      "description": "Provide a Password for Oracle Databases i.e SDB_DB, TMS_DB, REPORT_DB and WPDS_DB. The password will be used to connect the Oracle Databases.",
      "name": "IG_DBS_PASSWORDS",
      "value": ""
    }
  ]
}
